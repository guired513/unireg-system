<% layout('layouts/layout') -%>

<h1>User Management Panel</h1>

<table border="1">
  <tr>
    <th>Name</th>
    <th>Email</th>
    <th>Current Role</th>
    <th>Status</th>
    <th>Actions</th>
  </tr>
  <% users.forEach(user => { %>
    <tr>
      <td><%= user.name %></td>
      <td><%= user.email %></td>
      <td><%= user.role %></td>
      <td><%= user.isActive ? "Active" : "Deactivated" %></td>
      <td>
        <!-- Role Change -->
        <form action="/admin/users/update-role" method="POST" style="display:inline;">
          <input type="hidden" name="userId" value="<%= user._id %>">
          <select name="role">
            <option <%= user.role === "student" ? "selected" : "" %>>student</option>
            <option <%= user.role === "faculty" ? "selected" : "" %>>faculty</option>
            <option <%= user.role === "registrar" ? "selected" : "" %>>registrar</option>
            <option <%= user.role === "accounting" ? "selected" : "" %>>accounting</option>
            <option <%= user.role === "admin" ? "selected" : "" %>>admin</option>
            <option <%= user.role === "superadmin" ? "selected" : "" %>>superadmin</option>
          </select>
          <button type="submit">Update</button>
        </form>

        <!-- Activate/Deactivate -->
        <form action="/admin/users/toggle-status" method="POST" style="display:inline;">
          <input type="hidden" name="userId" value="<%= user._id %>">
          <button type="submit">
            <%= user.isActive ? "Deactivate" : "Activate" %>
          </button>
        </form>
      </td>
    </tr>
  <% }) %>
</table>
